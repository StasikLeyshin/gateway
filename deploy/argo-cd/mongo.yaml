#apiVersion: apps/v1beta1
#kind: StatefulSet
#metadata:
#  name: mongo
#spec:
#  selector:
#    matchLabels:
#      role: mongo
#      environment: test
#  serviceName: "mongo"
#  replicas: 3
#  template:
#    metadata:
#      labels:
#        role: mongo
#        environment: test
#    spec:
#      terminationGracePeriodSeconds: 10
#      containers:
#        - name: mongo
#          image: mongo:8.0
#          command:
#            - mongod
#            - "--replSet"
#            - rs0
#            - "--smallfiles"
#            - "--noprealloc"
#          ports:
#            - containerPort: 27017
#          volumeMounts:
#            - name: mongo-persistent-storage
#              mountPath: /data/db
#        - name: mongo-sidecar
#          image: cvallance/mongo-k8s-sidecar
#          env:
#            - name: MONGO_SIDECAR_POD_LABELS
#              value: "role=mongo,environment=test"
#  volumeClaimTemplates:
#    - metadata:
#        name: mongo-persistent-storage
#      spec:
#        storageClassName: "fast"
#        accessModes: ["ReadWriteOnce"]
#        resources:
#          requests:
#            storage: 100Gi
#---
#apiVersion: v1
#kind: Service
#metadata:
#  name: mongo
#  labels:
#    name: mongo
#spec:
#  ports:
#    - port: 27017
#      targetPort: 27017
#  clusterIP: None
#  selector:
#    role: mongo

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mongodb
spec:
  serviceName: mongodb-service
  replicas: 1
  selector:
    matchLabels:
      app: mongodb
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
        - name: mongodb
          image: mongo:8.0
          ports:
            - containerPort: 27017
          volumeMounts:
            - name: mongodb-data
              mountPath: /data/db
  volumeClaimTemplates:
    - metadata:
        name: mongodb-data
      spec:
        #storageClassName: "fast"
        accessModes: [ "ReadWriteOnce" ]
        resources:
          requests:
            storage: 1Gi

---
apiVersion: v1
kind: Service
metadata:
  name: mongodb-service
spec:
  selector:
    app: mongodb
  ports:
    - name: mongodb
      port: 27017
      targetPort: 27017
  clusterIP: None